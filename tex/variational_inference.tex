\documentclass{article}
\usepackage[noend]{algpseudocode}
\usepackage[]{algorithm}
\usepackage{amsmath}
\usepackage[cm]{fullpage}
\newcommand{\var}[1]{{\operatorname{\mathit{#1}}}}

\begin{document}
\begin{algorithm}
   \caption{Variational Inference}   
   \Comment{$\var{mod-params}$ is a tuple $(\mu, \Sigma, \beta)$.}
   \Comment{$\var{var-params}$ is a tuple $(\zeta, \phi, \lambda, \nu^2)$.}
   \begin{algorithmic}[1]
      \Function{optimize-zeta}{$\lambda, \nu^2$}
      \State \Return $\sum{}{e^{\lambda + \frac{1}{2}\nu^2}}$
      \EndFunction
      
      \Function{optimize-lambda}{$\lambda, \nu^2$}
    	  \Function{objective-lambda}{params}
		      \State\Return 
	      \EndFunction
     	  \Function{objective-lambda-gradient}{params}
		      \State\Return 
	      \EndFunction
	  \State $\lambda\gets $ result from a SciPy optimizer using functions \Call{objective-lambda}{} and \Call{objective-lambda-gradient}{}
      \State \Return $\lambda$
      \EndFunction
      
      \Function{optimize-nu-sq}{$\lambda, \nu^2$}
      
	\Comment{The objective functions use the $\nu^2$ given in the function parameters instead of the one in $\var{var-params}$}      
    	  \Function{objective-nu-sq}{$\nu^2, \var{var-params}, \var{mod-params}$}
		      \State\Return $trace(\frac{1}{2}diag(\nu^2)\Sigma^{-1}) + \frac{N}{\zeta}\sum{}{e^{\lambda + \frac{1}{2}\nu^2}} - \frac{1}{2}\sum{}{(1 + log(2\pi nu^2))}$
	      \EndFunction
     	  \Function{objective-nu-sq-gradient}{$\nu^2, \var{var-params}, \var{mod-params}$}
		      \State\Return $\frac{1}{2}diag(\Sigma^{-1}) + \frac{N}{2\zeta}e^{\lambda + \frac{1}{2}\nu^2} - \frac{1}{2\nu^2}$
	      \EndFunction
	  \State $\nu^2\gets $ result from a SciPy optimizer using functions \Call{objective-nu-sq}{} and \Call{objective-nu-sq-gradient}{}
      \State \Return $\nu^2$
      \EndFunction
      
      \Function{optimize-phi}{$\var{var-params}, \var{mod-params}, w, n$}
		\State $\phi_{n,i}\gets e^{\lambda_i}\beta_{i, w_n}n_n$
	  \State Normalize $\phi$ so that every row sums up to 1
      \State \Return $\phi$
      \EndFunction
   
      \Function{variational-inference}{$\var{mod-params}=(\mu, \Sigma, \beta$), $w, n$}
      \State Initialize the variational parameters: $\var{var-params}=(\zeta=10, \phi=1, \lambda=0, \nu^2=1$)
      \While{likelihood bound is changing}
      \State $\zeta\gets \Call{optimize-zeta}{\lambda, \nu^2}$
      \State $\lambda\gets \Call{optimize-lambda}{\var{var-params}, \var{mod-params}}$
      \State $\zeta\gets \Call{optimize-zeta}{\lambda, \nu^2}$
      \State $\nu^2\gets \Call{optimize-nu-sq}{\var{var-params}, \var{mod-params}}$
      \State $\zeta\gets \Call{optimize-zeta}{\lambda, \nu^2}$      
      \State $\phi\gets \Call{optimize-phi}{\var{var-params}, \var{mod-params}, w, n}$
      \EndWhile
    \State \Return $\var{var-params}$
    \EndFunction
\end{algorithmic}
\end{algorithm}
\end{document}	